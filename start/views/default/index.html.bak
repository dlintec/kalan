{{extend 'dit_layout.html'}}
{{block head}}

<title>dlintec</title>

<!--link href="{{=URL('static','dit/Babylon/samples/index.css')}}" rel="stylesheet" /-->
<!--script src="{{=URL('static','dit/Babylon/hand.minified-1.2.js')}}"></script-->
<!--script src="{{=URL('static','dit/Babylon/dist/poly2tri.js')}}"></script-->
<!--script src="{{=URL('static','dit/Babylon/dist/cannon.js')}}"></script-->
<!--script src="{{=URL('static','dit/Babylon/dist/Oimo.js')}}"></script-->
<!--script src="{{=URL('static','dit/Babylon/dist/babylon.2.1.js')}}"></script-->

<link rel="shortcut icon" href="{{=URL('static','favicon.ico')}}" type="image/x-icon">
<link rel="apple-touch-icon" href="{{=URL('static','favicon.png')}}">

<link rel="stylesheet" href="{{=URL('static','dit/jqwidgets/styles/jqx.base.css')}}" type="text/css" />
<script type="text/javascript" src="{{=URL('static','dit/jqwidgets/jqxcore.js')}}"></script>
    <script type="text/javascript" src="{{=URL('static','dit/jqwidgets/jqxbuttons.js')}}"></script>
    <script type="text/javascript" src="{{=URL('static','dit/jqwidgets/jqxscrollbar.js')}}"></script>
    <script type="text/javascript" src="{{=URL('static','dit/jqwidgets/jqxpanel.js')}}"></script>
    <script type="text/javascript" src="{{=URL('static','dit/jqwidgets/jqxtree.js')}}"></script>
    <script type="text/javascript" src="{{=URL('static','dit/jqwidgets/jqxexpander.js')}}"></script>
<!--
<script type="text/javascript" src="{{=URL('static','dit/jqwidgets/jqxcore.js')}}"></script>
<script type="text/javascript" src="{{=URL('static','dit/jqwidgets/jqxdata.js')}}"></script>
<script type="text/javascript" src="//maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript" src="{{=URL('static','dit/gmaps/gmaps.min.js')}}"></script>
-->
<style type="text/css">
        table {
            font-family: verdana,arial,sans-serif;
            font-size: 11px;
            color: #333333;
            border-width: 1px;
            border-color: #666666;
            border-collapse: collapse;
        }
            table th {
                border-width: 1px;
                padding: 8px;
                border-style: solid;
                border-color: #666666;
                background-color: #dedede;
            }
            table td {
                border-width: 1px;
                padding: 8px;
                border-style: solid;
                border-color: #666666;
                background-color: #ffffff;
            }
</style>
{{end}}


<div class="html-scroll">
   <div class="dit_title_left"> Gestión de Seguridad de la Información</div>

    <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="x_panel">
                <div class="x_content">

                    <div id="mainb" style="height:300px;" ></div>

                </div>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="x_panel">
                <div class="x_content">
                    <div id='jqxWidget'>
                        <div id='jqxExpander'>
                            <div>
                                Documentación
                            </div>
                            <div style="overflow: hidden;">
                                <div style="border: none;" id='jqxTree'>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    
</div>
{{block page_js}}
<script>
function respuestaObtenerSG(msg){
    console.log("respuesta obtenerSG:",msg);
    llenarArbol(msg);
}
    
function obtenerSG(popciones){
    console.log('obtenerSG:');
    $.ajax({
      type: "POST",
      url: "{{=URL(request.application,'default','SG_inicio.json')}}",
      data: "opciones="+JSON.stringify(popciones)
   }).done(respuestaObtenerSG);
}
function llenarArbol(pObjeto){
    $('#jqxExpander').jqxExpander({ showArrow: false, toggleMode: 'none', width: '100%', height: '250px'});
            // Create jqxTree
    var itemsDoc={};
    for(var i=0, len=pObjeto.ESTANDARES.length; i < len; i++){
          itemsDoc[pObjeto.ESTANDARES.id]=pObjeto.ESTANDARES.TITULO;
    }
    var source = [
            {
                icon: "{{=URL('static','dit/img/flat_ico/dit/certif.png')}}", label: "Normatividad", expanded: true, items: [
                  { icon: "{{=URL('static','dit/img/flat_ico/dit/certif.png')}}", label: "Calendar" },
                  { icon: "{{=URL('static','dit/img/flat_ico/dit/certif.png')}}", label: "Contacts", selected: true }
                ]
            },
            {
                icon: "{{=URL('static','dit/img/flat_ico/dit/certif.png')}}", label: "Inbox", expanded: true, items: [
                 { icon: "{{=URL('static','dit/img/flat_ico/dit/certif.png')}}", label: "Admin" },
                 { icon: "{{=URL('static','dit/img/flat_ico/dit/certif.png')}}", label: "Corporate" },
                 { icon: "{{=URL('static','dit/img/flat_ico/dit/certif.png')}}", label: "Finance" },
                 { icon: "{{=URL('static','dit/img/flat_ico/dit/certif.png')}}", label: "Other" },
                ]
            },
            { icon: "../../images/recycle.png", label: "Deleted Items" },
            { icon: "../../images/notesIcon.png", label: "Notes" },
            { iconsize: 14, icon: "../../images/settings.png", label: "Settings" },
            { icon: "../../images/favorites.png", label: "Favorites" }
            ];
            $('#jqxTree').jqxTree({ source: source, width: '100%', height: '100%'});
            $('#jqxTree').jqxTree('selectItem', null);
}
function graficar() {
	console.log("Graficando...");
    obtenerSG({nivel:0});
	var myChart9 = echarts.init(document.getElementById('mainb'), theme);
	dit_registrar_echart(myChart9);
	var option = {
		title : {
            position: [0,0],
			text: '{{=T("Estructura de Control")}}',
			subtext: 'ISO 27001:2013'
		},
		tooltip : {
			trigger: 'item',
			formatter: "{b}: {c}",
			position: [5,300],
		},
		toolbox: {
			show : false,
			feature : {
				mark : {show: false},
				dataView : {show: false, readOnly: false},
				restore : {show: true,title:"refrescar", color:"#ccc"},
				saveAsImage : {show: true, title:"Guardar", color:"#ccc"}
			}
		},
		calculable : false,

		series : [
			{
				name:'Documentación',
				type:'tree',
				orient: 'horizontal',  // vertical horizontal
				rootLocation: {x: 50, y: '60%'}, // {x: 'center',y: 10}
				nodePadding: 5,
                layerPadding:20,
				symbol: 'circle',
				symbolSize: 40,
                roam:false,
				itemStyle: {
					normal: {
						label: {
							show: true,
							position: 'top',
							textStyle: {
								color: '#999999',
								fontSize: 10,
								fontWeight:  'normal',
								baseline: 'bottom'
							}
						},
						lineStyle: {
							color: '#eee',
							width: 5,
							type: 'solid' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
						}
					},
					emphasis: {
						label: {
							show: false
						}
					}
				},
				data: [
					{
						name: 'Documentación',
                        value: {
                            url:"{{=URL('default','index.html')}}",
                        },
						symbolSize: [50, 50],
						symbol: "image://{{=URL('static','dit/img/flat_ico/dit/libreria.png')}}",
						itemStyle: {
							normal: {
								label: {
									show: true,
									position: 'bottom',
								}
							}
						},
						children: [
							{
								name: '{{=T("Normatividad")}}',
								value: 4,
								symbol: "image://{{=URL('static','dit/img/flat_ico/dit/certif.png')}}",
								itemStyle: {
									normal: {
										label: {
											show: true,
											position: 'bottom',
											color: '#000000'
										}
									}
								},
								symbolSize: [50, 50],
										value: {
											url:"{{=URL(request.application,'default','SG_control')}}",
										},
								children: [
									{
										name: 'Secciones',
										symbol: 'circle',
										symbolSize: 40,
										value: {
											url:"{{=URL('default','SG_control?t=DOMINIOS')}}",
										},
										itemStyle: {
											normal: {
												color: '#3A93CB',
												label: {
													show: true,
													position: 'right'
												},

											},
											emphasis: {
												label: {
													show: false
												},
												borderWidth: 0
											}
										}
									},
									{
										name: 'Objetivos',
										value: {
											url:"{{=URL('default','SG_control?t=OBJETIVOS')}}",
										},
										symbol: 'circle',
										symbolSize: 40,
										itemStyle: {
											normal: {
												label: {
													show: true,
													position: 'right',
													formatter: "{b}"
												},
												color: '#3A93CB',

											},
											emphasis: {
												borderWidth: 0
											}
										}
									},
									{
										name: 'Controles',
										metodo: 'ConfEjec',
										symbol: 'circle',
										symbolSize: 40,
										value: {
											url:"{{=URL('default','SG_control?t=CONTROLES')}}",
										},
										itemStyle: {
											normal: {
												color: '#3A93CB',
												label: {
													show: true,
													position: 'right'
												},

											},
											emphasis: {
												label: {
													show: false
												},
												borderWidth: 0
											}
										}
									}

								]
							},

							{
								name: 'Sistema',
								symbol: "image://{{=URL('static','dit/img/icono.png')}}",
								symbolSize: [57, 50],
								itemStyle: {
									normal: {
										label: {
											show: true,
											position: 'bottom',
										}

									}
								},
								value: 2,
								children: [
									{
										name: 'Usuarios',
										symbol: 'circle',
										symbolSize: 40,
										value: {
											url:"{{=URL('default','dit_usuarios')}}",
										},
										itemStyle: {
											normal: {
												color: '#3A93CB',
												label: {
													show: true,
													position: 'right'
												},

											},
											emphasis: {
												label: {
													show: false
												},
												borderWidth: 0
											}
										}
									},



								]
							}
						]
					}
				]
			}

		]
	};
	myChart9.setOption(option);
	myChart9.on(echartsConfig.EVENT.CLICK, eConsole);
	myChart9.on(echartsConfig.EVENT.DBLCLICK, eConsole);
	//myChart.on(ecConfig.EVENT.HOVER, eConsole);
	myChart9.on(echartsConfig.EVENT.DATA_ZOOM, eConsole);
	myChart9.on(echartsConfig.EVENT.LEGEND_SELECTED, eConsole);
	myChart9.on(echartsConfig.EVENT.MAGIC_TYPE_CHANGED, eConsole);
	myChart9.on(echartsConfig.EVENT.DATA_VIEW_CHANGED, eConsole);	
	function eConsole(param) {
		var mes = '**' + param.type + '**';
		if (typeof param.seriesIndex != 'undefined') {
			mes += '  seriesIndex : ' + param.seriesIndex;
			mes += '  dataIndex : ' + param.dataIndex;
		}
		if (typeof param.data.value == 'object'){
			console.log("Es objeto");
			console.log('URL:',param.data.value.url,typeof param.data.value);
			window.location=param.data.value.url;
		}
		if (param.type == 'hover') {
            console.log('hover:','Event Console : ' + mes);
		   // document.getElementById('hover-console').innerHTML = 'Event Console : ' + mes;
		}
		else {
            console.log(mes);
		   // document.getElementById('console').innerHTML = mes;
		}
		console.log(param);
	}

    
}
document.addEventListener("DOMContentLoaded", graficar);	
</script>
{{end page_js}}
