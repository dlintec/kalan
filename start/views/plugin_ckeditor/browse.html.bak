{{extend 'dit_layout.html'}}
{{from gluon import *}}
<style type="text/css">
    div.item {
        display: inline-block;
        min-width: 104px;
        height: 126px;
        border: 0px solid gray;
        -moz-border-radius: 3px;
        border-radius: 3px;
        padding: 5px;
        margin-left: 5px;
        text-align: center;
        cursor: pointer;
        overflow: hidden;
        background:#CCC;
		background-color:#eee;

    }
    
    div.item:hover {
        background: #aaa;
    }
    
    div.item span.delete {
        float: right;
        padding: 2px;
        border: 0px solid gray;
        -moz-border-radius: 3px;
        border-radius: 0px;
        margin: -0px;
        margin-bottom: 2px;
        font-weight: bold;
		background:#CCC;
        color: white;
    }
    
    div.item span.delete:hover {
		background-color:red;
        color: white;
    }

    img {
		background:white;
        max-width: 100px;
        max-height: 100px;
        border: 1px solid #ccc;
    }
</style>

{{
    def icon_url(category):
        url = URL('static', 'dit/img') + '/web_ico/32/'
        if category == 'video':
            return url + '_dvd.png'
        elif category == 'pdf':
            return url + 'acrobat1.png'
        elif category == 'archive':
            return url + '_compress.png'
        elif category == 'excel':
            return url + '_excel.png'
        elif category == 'flash':
            return url + '_flash.png'
        elif category == 'powerpoint':
            return url + '_powerpoint.png'
        else:
            return url + '.png'
    pass
}}

<h3 class='pad5'>{{=response.title}}</h3>
{{for row in rows:}}
    <div class="item" data-url="{{=row.upload}}">
        <span class="delete">&nbsp;x&nbsp;</span>
        {{category = current.plugin_ckeditor.filetype(row.filename)}}
        {{url = URL('default', 'download', args=[row.upload])}}
        {{if category != 'image':}}
            {{url = icon_url(category)}}
        {{pass}}
        <img src="{{=url}}" />
        <div>{{=T(row.title)}}</div>
    </div>
{{pass}}

{{if len(rows) == 0:}}
    <span>There is nothing here. Please upload something first.</span>
{{pass}}

<script type="text/javascript">
    jQuery(function() {
        jQuery('.delete').click(function() {
            if (confirm('{{=T("Are you sure you want to delete this item? This cannot be undone and will cause any references to this item to fail.")}}')) {
                var url = '{{=URL('plugin_ckeditor', 'delete')}}/' + jQuery(jQuery(this).parent()).data('url');
                jQuery.post(url, function() {
                    window.location.reload(true);
                });
            }
            return false;
        });
        
        jQuery('.item').click(function() {
            var url = '{{=URL('default', 'download')}}/' + jQuery(this).data('url');
            window.opener.CKEDITOR.tools.callFunction({{=cknum}}, url);
            window.close();
        });
    });
</script>
